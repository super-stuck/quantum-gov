flowchart TD
    Start([Initialize System]) --> HumanInput[Human Values Input]
    HumanInput --> ExtractValues[Extract Core Values]
    ExtractValues --> ValueModel[Value Model H(Ïˆ)]

    ValueModel --> AISystem[AI System Ï€(Î¸)]
    AISystem --> Interaction[Human-AI Interaction]

    Interaction --> CollectData[Collect Interaction Data]
    CollectData --> ComputeReward[Compute Reward Signals]

    ComputeReward --> ValueAlignment{Value Alignment Check}

    ValueAlignment -->|Misaligned| UpdateValueModel[Update Value Model]
    UpdateValueModel --> ComputeLoss[Compute Alignment Loss]
    ComputeLoss --> UpdateAI[Update AI Parameters]
    UpdateAI --> Interaction

    ValueAlignment -->|Aligned| ShapleyCompute[Compute Shapley Values]
    ShapleyCompute --> Output[Aligned Output]
    Output --> Feedback[Collect Feedback]
    Feedback --> CollectData

    subgraph "Value Alignment Mechanism"
        ValueAlignmentLoss[L = E[R] + Î»E[V_human] - Î¼KL(Ï€||Ï€_human)]
        Constraint[argmax E[V_human] âŠ† argmax E[R_AI]]
    end

    ComputeLoss --> ValueAlignmentLoss
    UpdateAI --> Constraint

    subgraph "Cooperative Game Theory"
        Shapley[Ï†áµ¢(v) = âˆ‘|S|!(|N|-|S|-1)!/|N|! Ã— [v(Sâˆª{i}) - v(S)]]
        Fairness[Ensure Fair Contribution Attribution]
    end

    ShapleyCompute --> Shapley
    Shapley --> Fairness

    subgraph "Cultural Adaptation"
        Culture[Hofstede Dimensions: PDI, IDV, MAS, UAI, LTO, IVR]
        Adaptation[Ï€áµ¢^cultural(s) = Î£wáµ¢^d Ã— Ï€_d(s|culture_d)]
    end

    ExtractValues --> Culture
    Culture --> Adaptation
    Adaptation --> ValueModel

    subgraph "Privacy Preservation"
        DifferentialPrivacy[P[ð’œ(D) âˆˆ S] â‰¤ e^Îµ Ã— P[ð’œ(D') âˆˆ S]]
        Noise[Add Gaussian Noise]
    end

    CollectData --> DifferentialPrivacy
    DifferentialPrivacy --> Noise
    Noise --> ComputeReward

    %% Styling
    classDef startEnd fill:#764ba2,stroke:#667eea,color:#fff,stroke-width:2px
    classDef process fill:#667eea,stroke:#764ba2,color:#fff,stroke-width:2px
    classDef decision fill:#ffa500,stroke:#ff6b6b,color:#fff,stroke-width:2px
    classDef subgraph fill:#f0f0f0,stroke:#ccc,stroke-width:2px

    class Start,Output startEnd
    class HumanInput,ExtractValues,ValueModel,AISystem,Interaction,CollectData,ComputeReward,UpdateValueModel,ComputeLoss,UpdateAI,ShapleyCompute,Feedback process
    class ValueAlignment decision
    class ValueAlignmentMechanism,CooperativeGameTheory,CulturalAdaptation,PrivacyPreservation subgraph
